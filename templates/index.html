<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Footle</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <style>
        /* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0e0e0e;
            --surface: #1a1a1a;
            --surface2: #242424;
            --border: #333;
            --text: #e0e0e0;
            --text-dim: #888;
            --green: #22c55e;
            --yellow: #eab308;
            --red: #ef4444;
            --accent: #3b82f6;
            --radius: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        header {
            width: 100%;
            max-width: 720px;
            text-align: center;
            padding: 28px 16px 12px;
            border-bottom: 1px solid var(--border);
            position: relative;
            /* Added for help button positioning */
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        header p {
            color: var(--text-dim);
            font-size: 0.85rem;
            margin-top: 4px;
        }

        /* â”€â”€ Help Button & Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .icon-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            color: var(--text);
            border-color: var(--text);
            background: var(--surface);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background-color: var(--surface);
            border: 1px solid var(--border);
            padding: 24px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            animation: pop-in 0.25s ease-out;
        }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 16px;
            color: var(--text-dim);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: var(--text);
        }

        .modal h2 {
            margin-bottom: 16px;
            font-size: 1.4rem;
        }

        .modal ul {
            margin-left: 20px;
            line-height: 1.6;
            font-size: 0.95rem;
            color: var(--text-dim);
        }

        .modal li {
            margin-bottom: 8px;
        }

        .modal strong {
            color: var(--text);
        }

        .color-box {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 6px;
        }

        /* â”€â”€ Mode Switcher â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .mode-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .mode-bar button {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.15s;
        }

        .mode-bar button:hover {
            background: var(--surface2);
        }

        .mode-bar button.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }

        /* â”€â”€ Search Box â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .search-area {
            width: 100%;
            max-width: 480px;
            margin: 24px auto 0;
            position: relative;
            padding: 0 16px;
        }

        .search-area input {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.15s;
        }

        .search-area input:focus {
            border-color: var(--accent);
        }

        .search-area input::placeholder {
            color: var(--text-dim);
        }

        /* â”€â”€ Autocomplete Dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .autocomplete {
            position: absolute;
            top: 100%;
            left: 16px;
            right: 16px;
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: 0 0 var(--radius) var(--radius);
            max-height: 320px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .autocomplete.open {
            display: block;
        }

        .ac-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            cursor: pointer;
            transition: background 0.1s;
        }

        .ac-item:hover,
        .ac-item.selected {
            background: var(--surface);
        }

        .ac-item img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--surface);
        }

        .ac-item .ac-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .ac-item .ac-club {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* â”€â”€ Guess Counter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .guess-counter {
            text-align: center;
            margin-top: 16px;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        /* â”€â”€ Guess History Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .history {
            width: 100%;
            max-width: 720px;
            margin: 20px auto 0;
            padding: 0 16px;
        }

        .history-header,
        .history-row {
            display: grid;
            grid-template-columns: 40px 1.2fr 1fr 1fr 0.9fr 0.8fr 0.6fr 0.6fr;
            gap: 6px;
            margin-bottom: 6px;
        }

        .history-header>div {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            padding: 6px 8px;
            text-align: center;
        }

        .history-row>div {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px 8px;
            border-radius: var(--radius);
            font-size: 0.82rem;
            font-weight: 600;
            text-align: center;
            animation: pop-in 0.3s ease-out;
            min-height: 44px;
            line-height: 1.2;
        }

        @keyframes pop-in {
            0% {
                transform: scale(0.85);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .cell-correct {
            background: var(--green);
            color: #000;
        }

        .cell-close {
            background: var(--yellow);
            color: #000;
        }

        .cell-wrong {
            background: var(--red);
            color: #fff;
        }

        .cell-neutral {
            background: var(--surface2);
            color: var(--text);
        }

        .cell-player {
            background: var(--surface2);
            justify-content: flex-start !important;
            gap: 8px;
            overflow: hidden;
        }

        .cell-player img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .cell-player span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .direction-arrow {
            font-size: 0.75rem;
            margin-left: 4px;
            font-weight: 400;
        }

        /* â”€â”€ Game Over Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .game-over-banner {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            margin-top: 28px;
            padding: 24px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            max-width: 480px;
            width: calc(100% - 32px);
            animation: pop-in 0.35s ease-out;
        }

        .game-over-banner.visible {
            display: flex;
        }

        .game-over-banner h2 {
            font-size: 1.3rem;
        }

        .game-over-banner .target-reveal {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-top: 4px;
        }

        .target-reveal img {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--surface2);
        }

        .target-reveal .reveal-info {
            text-align: left;
        }

        .target-reveal .reveal-name {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .target-reveal .reveal-meta {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .game-over-banner .stats-line {
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .play-again-btn {
            margin-top: 8px;
            padding: 10px 28px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.15s;
        }

        .play-again-btn:hover {
            opacity: 0.85;
        }

        /* â”€â”€ Radar Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .radar-section {
            display: none;
            margin-top: 24px;
            padding: 0 16px;
            width: 100%;
            max-width: 420px;
        }

        .radar-section.visible {
            display: block;
        }

        .radar-section h3 {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .radar-section canvas {
            max-height: 300px;
        }

        /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        footer {
            margin-top: auto;
            padding: 24px 16px;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        /* â”€â”€ Confetti animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -20px;
            animation: confetti-fall 2.5s ease-in forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(105vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* â”€â”€ Win banner glow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .game-over-banner.won {
            border-color: var(--green);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.15);
        }

        .game-over-banner.won h2 {
            color: var(--green);
        }

        .congrats-msg {
            font-size: 0.9rem;
            color: var(--text);
            text-align: center;
            margin-top: 2px;
        }

        /* â”€â”€ Mobile Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.6rem;
                letter-spacing: 2px;
            }

            header p {
                font-size: 0.75rem;
            }

            .mode-bar {
                gap: 8px;
                margin-top: 16px;
            }

            .mode-bar button {
                padding: 6px 16px;
                font-size: 0.8rem;
            }

            .search-area {
                max-width: 100%;
                margin-top: 16px;
            }

            .search-area input {
                padding: 12px 14px;
                font-size: 0.95rem;
            }

            .guess-counter {
                font-size: 0.8rem;
                margin-top: 12px;
            }

            .history {
                max-width: 100%;
                padding: 0 8px;
                overflow-x: auto;
            }

            .history-header,
            .history-row {
                grid-template-columns: 30px 1fr 0.8fr 0.8fr 0.75fr 0.6fr 0.5fr 0.5fr;
                gap: 4px;
                margin-bottom: 4px;
            }

            .history-header>div {
                font-size: 0.6rem;
                padding: 4px 4px;
            }

            .history-row>div {
                padding: 8px 4px;
                font-size: 0.7rem;
                min-height: 38px;
            }

            .cell-player {
                gap: 6px;
            }

            .cell-player img {
                width: 24px;
                height: 24px;
            }

            .direction-arrow {
                font-size: 0.7rem;
            }

            .game-over-banner {
                max-width: 100%;
                padding: 20px 16px;
                gap: 10px;
                margin-top: 20px;
            }

            .game-over-banner h2 {
                font-size: 1.1rem;
            }

            .target-reveal img {
                width: 48px;
                height: 48px;
            }

            .reveal-name {
                font-size: 1rem !important;
            }

            .reveal-meta {
                font-size: 0.7rem !important;
            }

            .game-over-banner .stats-line {
                font-size: 0.8rem;
            }

            .play-again-btn {
                padding: 8px 24px;
                font-size: 0.9rem;
            }

            .radar-section {
                max-width: 100%;
                padding: 0 8px;
            }

            .radar-section h3 {
                font-size: 0.8rem;
            }

            .autocomplete {
                left: 8px;
                right: 8px;
                max-height: 240px;
            }

            .ac-item {
                padding: 8px 12px;
                gap: 10px;
            }

            .ac-item img {
                width: 32px;
                height: 32px;
            }

            .ac-item .ac-name {
                font-size: 0.85rem;
            }

            .ac-item .ac-club {
                font-size: 0.7rem;
            }

            footer {
                padding: 20px 12px;
                font-size: 0.7rem;
            }
        }

        /* Small mobile devices */
        @media (max-width: 480px) {
            header {
                padding: 20px 12px 10px;
            }

            header h1 {
                font-size: 1.4rem;
                letter-spacing: 1px;
            }

            .history {
                padding: 0 4px;
            }

            .history-header,
            .history-row {
                grid-template-columns: 25px 1fr 0.7fr 0.7fr 0.65fr 0.5fr 0.45fr 0.45fr;
                gap: 3px;
                margin-bottom: 3px;
            }

            .history-header>div {
                font-size: 0.55rem;
                padding: 3px 2px;
                letter-spacing: 0;
            }

            .history-row>div {
                padding: 6px 2px;
                font-size: 0.65rem;
                min-height: 34px;
            }

            .cell-player {
                gap: 4px;
            }

            .cell-player img {
                width: 20px;
                height: 20px;
            }

            .cell-player span {
                font-size: 0.65rem;
            }

            .game-over-banner {
                padding: 16px 12px;
            }

            .game-over-banner h2 {
                font-size: 1rem;
            }

            .target-reveal {
                gap: 10px;
            }

            .target-reveal img {
                width: 40px;
                height: 40px;
            }

            .reveal-name {
                font-size: 0.9rem !important;
            }

            .reveal-meta {
                font-size: 0.65rem !important;
            }
        }
    </style>
</head>

<body>

    <header>
        <button id="help-btn" class="icon-btn" aria-label="How to play">?</button>
        <h1>Footle</h1>
        <p>Guess the footballer, Wordle style!</p>
    </header>

    <div class="mode-bar">
        <button id="btn-daily" class="active" onclick="startGame('daily')">Daily</button>
        <button id="btn-random" onclick="startGame('random')">Random</button>
    </div>

    <div class="search-area">
        <input type="text" id="search-input" placeholder="Type a player nameâ€¦" autocomplete="off" disabled />
        <div class="autocomplete" id="ac-dropdown"></div>
    </div>

    <div class="guess-counter" id="guess-counter"></div>

    <div class="history" id="history">
        <div class="history-header">
            <div></div>
            <div>Player</div>
            <div>Nation</div>
            <div>Club</div>
            <div>League</div>
            <div>Position</div>
            <div>Age</div>
            <div>OVR</div>
        </div>
    </div>

    <div class="radar-section" id="radar-section">
        <h3>Last Guess vs Target</h3>
        <canvas id="radar-chart"></canvas>
    </div>

    <div class="game-over-banner" id="game-over-banner">
        <h2 id="go-title"></h2>
        <div class="target-reveal" id="go-reveal"></div>
        <div class="stats-line" id="go-stats"></div>
        <button class="play-again-btn" onclick="startGame(currentMode)">Play Again</button>
    </div>

    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-help">&times;</span>
            <h2>How to Play</h2>
            <ul>
                <li>Guess the mystery player in <strong>8 tries</strong>.</li>
                <li><span class="color-box" style="background:var(--green)"></span><strong>Green:</strong> Exact match.
                </li>
                <li><span class="color-box" style="background:var(--yellow)"></span><strong>Yellow:</strong> Close match
                    (same continent, position group, or within 2 for stats).</li>
                <li><span class="color-box" style="background:var(--red)"></span><strong>Red:</strong> No match.</li>
                <li>Arrows (â†‘/â†“) show if Age/Overall is higher or lower.</li>
            </ul>
        </div>
    </div>

    <footer>I got bored in a lecture and made this â¤ï¸</footer>

    <script>
        // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let currentMode = "daily";
        let guessCount = 0;
        let maxGuesses = 8;
        let gameOver = false;
        let acIndex = -1;            // highlighted autocomplete index
        let radarChart = null;       // Chart.js instance

        // â”€â”€ Start / restart game â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function startGame(mode) {
            currentMode = mode;
            guessCount = 0;
            gameOver = false;
            acIndex = -1;

            // UI resets
            document.getElementById("history").innerHTML = `
        <div class="history-header">
          <div></div><div>Player</div><div>Nation</div><div>Club</div><div>League</div>
          <div>Position</div><div>Age</div><div>OVR</div>
        </div>`;
            document.getElementById("game-over-banner").classList.remove("visible");
            document.getElementById("radar-section").classList.remove("visible");
            if (radarChart) {radarChart.destroy(); radarChart = null;}
            document.getElementById("search-input").value = "";
            document.getElementById("search-input").disabled = true;

            document.querySelectorAll(".mode-bar button").forEach(b => b.classList.remove("active"));
            document.getElementById(mode === "daily" ? "btn-daily" : "btn-random").classList.add("active");

            const res = await fetch("/api/new_game", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({mode}),
            });
            const data = await res.json();
            maxGuesses = data.max_guesses || 8;
            updateCounter();

            document.getElementById("search-input").disabled = false;
            document.getElementById("search-input").focus();
        }

        function updateCounter() {
            document.getElementById("guess-counter").textContent =
                `Guess ${guessCount} / ${maxGuesses}`;
        }

        // â”€â”€ Autocomplete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const searchInput = document.getElementById("search-input");
        const acDropdown = document.getElementById("ac-dropdown");
        let debounceTimer = null;

        searchInput.addEventListener("input", () => {
            clearTimeout(debounceTimer);
            const q = searchInput.value.trim();
            if (q.length < 2) {closeAC(); return;}
            debounceTimer = setTimeout(() => fetchAC(q), 180);
        });

        searchInput.addEventListener("keydown", (e) => {
            const items = acDropdown.querySelectorAll(".ac-item");
            if (e.key === "ArrowDown") {
                e.preventDefault();
                acIndex = Math.min(acIndex + 1, items.length - 1);
                highlightAC(items);
            } else if (e.key === "ArrowUp") {
                e.preventDefault();
                acIndex = Math.max(acIndex - 1, 0);
                highlightAC(items);
            } else if (e.key === "Enter") {
                e.preventDefault();
                if (acIndex >= 0 && items[acIndex]) items[acIndex].click();
            } else if (e.key === "Escape") {
                closeAC();
            }
        });

        async function fetchAC(q) {
            const res = await fetch(`/api/autocomplete?q=${encodeURIComponent(q)}`);
            const players = await res.json();
            acDropdown.innerHTML = "";
            acIndex = -1;
            if (!players.length) {closeAC(); return;}
            players.forEach((p, i) => {
                const div = document.createElement("div");
                div.className = "ac-item";
                div.innerHTML = `
          <img src="${p.player_face_url || ''}" alt="" loading="lazy" onerror="this.style.display='none'"/>
          <div>
            <div class="ac-name">${p.short_name}</div>
            <div class="ac-club">${p.club_name}</div>
          </div>`;
                div.addEventListener("click", () => submitGuess(p.player_id));
                acDropdown.appendChild(div);
            });
            acDropdown.classList.add("open");
        }

        function highlightAC(items) {
            items.forEach((el, i) => el.classList.toggle("selected", i === acIndex));
        }

        function closeAC() {
            acDropdown.classList.remove("open");
            acDropdown.innerHTML = "";
            acIndex = -1;
        }

        // Close autocomplete when clicking outside
        document.addEventListener("click", (e) => {
            if (!e.target.closest(".search-area")) closeAC();
        });

        // â”€â”€ Submit Guess â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function submitGuess(playerId) {
            if (gameOver) return;
            closeAC();
            searchInput.value = "";

            const res = await fetch("/api/guess", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({player_id: playerId}),
            });
            const data = await res.json();

            if (data.error && !data.feedback) {
                // e.g. duplicate guess
                showToast(data.error);
                return;
            }

            guessCount = data.guess_number;
            updateCounter();

            // Render the history row
            renderRow(data.feedback);

            // Update radar chart
            updateRadar(data.feedback);

            // Check game over
            if (data.game_over) {
                gameOver = true;
                searchInput.disabled = true;
                showGameOver(data.won, data.target, data.guess_number);
            }
        }

        // â”€â”€ Render a guess row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderRow(fb) {
            const hist = document.getElementById("history");
            const row = document.createElement("div");
            row.className = "history-row";

            // # (row number)
            const numCell = document.createElement("div");
            numCell.className = "cell-neutral";
            numCell.textContent = guessCount;
            row.appendChild(numCell);

            // Player (face + name)
            const playerCell = document.createElement("div");
            playerCell.className = "cell-player";
            playerCell.innerHTML = `
        <img src="${fb.guess_face_url || ''}" alt="" onerror="this.style.display='none'"/>
        <span>${fb.guess_name}</span>`;
            row.appendChild(playerCell);

            // Nationality
            row.appendChild(makeCell(fb.nationality.value, fb.nationality.status));
            // Club
            row.appendChild(makeCell(fb.club.value, fb.club.status));
            // League
            row.appendChild(makeCell(fb.league.value, fb.league.status));
            // Position
            row.appendChild(makeCell(fb.position.value, fb.position.status));
            // Age
            row.appendChild(makeCell(
                fb.age.value + dirArrow(fb.age.direction),
                fb.age.status
            ));
            // Overall
            row.appendChild(makeCell(
                fb.overall.value + dirArrow(fb.overall.direction),
                fb.overall.status
            ));

            hist.appendChild(row);
        }

        function makeCell(text, status) {
            const div = document.createElement("div");
            const cls = status === "correct" ? "cell-correct"
                : status === "close" ? "cell-close"
                    : "cell-wrong";
            div.className = cls;
            div.innerHTML = text;
            return div;
        }

        function dirArrow(dir) {
            if (dir === "higher") return ' <span class="direction-arrow">â†‘</span>';
            if (dir === "lower") return ' <span class="direction-arrow">â†“</span>';
            return "";
        }

        // â”€â”€ Game Over â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const WIN_MESSAGES = [
            "Absolute worldie! ğŸŒ",
            "VAR confirms: you're a genius!",
            "Clean sheet mentality! ğŸ’ª"
        ];

        function showGameOver(won, target, numGuesses) {
            const banner = document.getElementById("game-over-banner");
            banner.classList.remove("won");

            if (won) {
                banner.classList.add("won");
                // Pick a random congratulations message
                const msg = WIN_MESSAGES[Math.floor(Math.random() * WIN_MESSAGES.length)];
                document.getElementById("go-title").textContent = "ğŸ‰ You got it!";
                document.getElementById("go-stats").innerHTML =
                    `<strong>${msg}</strong><br>Solved in ${numGuesses} / ${maxGuesses} guess${numGuesses === 1 ? '' : 'es'}`;
                // Launch confetti
                launchConfetti();
            } else {
                document.getElementById("go-title").textContent = "ğŸ˜ Better luck next time";
                document.getElementById("go-stats").textContent = `The answer was ${target.short_name}`;
            }

            document.getElementById("go-reveal").innerHTML = `
        <img src="${target.player_face_url || ''}" alt="" onerror="this.style.display='none'"/>
        <div class="reveal-info">
          <div class="reveal-name">${target.short_name}</div>
          <div class="reveal-meta">${target.club_name} Â· ${target.league_name}</div>
          <div class="reveal-meta">${target.nationality_name} Â· ${target.primary_position} Â· OVR ${target.overall}</div>
        </div>`;

            banner.classList.add("visible");
        }

        // â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function launchConfetti() {
            const container = document.createElement("div");
            container.className = "confetti-container";
            document.body.appendChild(container);

            const colors = ["#22c55e", "#eab308", "#3b82f6", "#ef4444", "#a855f7", "#ec4899", "#f97316"];
            for (let i = 0; i < 80; i++) {
                const piece = document.createElement("div");
                piece.className = "confetti-piece";
                piece.style.left = Math.random() * 100 + "%";
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 1.2 + "s";
                piece.style.animationDuration = (2 + Math.random() * 1.5) + "s";
                piece.style.width = (6 + Math.random() * 8) + "px";
                piece.style.height = (6 + Math.random() * 8) + "px";
                piece.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";
                container.appendChild(piece);
            }
            // Clean up after animation
            setTimeout(() => container.remove(), 4000);
        }

        // â”€â”€ Radar Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updateRadar(fb) {
            const section = document.getElementById("radar-section");
            section.classList.add("visible");

            const labels = ["Pace", "Shooting", "Passing", "Dribbling", "Defending", "Physic"];
            const guessData = labels.map(l => fb.guess_stats[l.toLowerCase()]);
            const targetData = labels.map(l => fb.target_stats[l.toLowerCase()]);

            if (radarChart) radarChart.destroy();

            const ctx = document.getElementById("radar-chart").getContext("2d");
            radarChart = new Chart(ctx, {
                type: "radar",
                data: {
                    labels,
                    datasets: [
                        {
                            label: fb.guess_name,
                            data: guessData,
                            borderColor: "rgba(59,130,246,0.9)",
                            backgroundColor: "rgba(59,130,246,0.15)",
                            pointBackgroundColor: "rgba(59,130,246,1)",
                            borderWidth: 2,
                        },
                        {
                            label: "Target",
                            data: targetData,
                            borderColor: "rgba(34,197,94,0.9)",
                            backgroundColor: "rgba(34,197,94,0.10)",
                            pointBackgroundColor: "rgba(34,197,94,1)",
                            borderWidth: 2,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            min: 0, max: 99,
                            ticks: {stepSize: 20, color: "#888", backdropColor: "transparent"},
                            grid: {color: "#333"},
                            angleLines: {color: "#333"},
                            pointLabels: {color: "#ccc", font: {size: 12}},
                        },
                    },
                    plugins: {
                        legend: {
                            labels: {color: "#ccc", font: {size: 12}},
                        },
                    },
                },
            });
        }

        // â”€â”€ Toast (simple) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function showToast(msg) {
            const el = document.createElement("div");
            el.textContent = msg;
            Object.assign(el.style, {
                position: "fixed", top: "20px", left: "50%", transform: "translateX(-50%)",
                background: "#333", color: "#eee", padding: "10px 24px", borderRadius: "8px",
                fontSize: "0.85rem", zIndex: "9999", animation: "pop-in 0.25s ease-out",
            });
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 2500);
        }

        // â”€â”€ Help Modal Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const helpBtn = document.getElementById("help-btn");
        const helpModal = document.getElementById("help-modal");
        const closeHelp = document.getElementById("close-help");

        helpBtn.addEventListener("click", () => helpModal.classList.add("open"));
        closeHelp.addEventListener("click", () => helpModal.classList.remove("open"));
        window.addEventListener("click", (e) => {
            if (e.target === helpModal) helpModal.classList.remove("open");
        });

        // â”€â”€ Auto-start daily game on load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        startGame("daily");
    </script>
</body>

</html>
